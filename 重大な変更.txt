robo_manip_baselines/envs/real/RealEnvBase.py
の107行目を変更しました。


robo_manip_baselines/envs/real/xarm7/RealXarm7EnvBase.py
の168~174に独自の条件分岐を与え、その前でも、set_mode(1)というように変更しました。

robo_manip_baselines/envs/real/xarm7/RealXarm7EnvBase.py
の以下の関数において、reset_bool=Trueという引数を追加しました。_set_actionにおいて、これがTrueのときはゆっくりとリセット姿勢へ戻り、10秒間待つようにしました。
    def _reset_robot(self):
        print(
            f"[{self.__class__.__name__}] Start moving the robot to the reset position."
        )

        self._set_action(
            self.init_qpos, duration=None, joint_vel_limit_scale=0.1, wait=True, 
        )

        print(
            f"[{self.__class__.__name__}] Finish moving the robot to the reset position."
        )


    def _set_actionにおける特別な処理。最後はreturnで終了する。
            if reset_bool:
            result = self.xarm_api.set_mode(6)
            self.xarm_api.set_state(0)
            
            for _ in range(10):
                time.sleep(0.2)
                if self.xarm_api.mode == 6:
                    print(self.xarm_api.mode)
                    break

            xarm_code = self.xarm_api.set_servo_angle(
                angle=arm_joint_pos_command,
                speed=scaled_joint_vel_limit,
                mvtime=duration,
                is_radian=True,
                wait=False,
            )

            time.sleep(10)
            self.xarm_api.set_mode(1)
            self.xarm_api.set_state(0)

            time.sleep(0.2)
            return None

